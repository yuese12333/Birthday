<div align="center">

# 生日互动回忆小游戏

一次把「过去 → 当下 → 未来」浓缩成互动旅程的 H5 礼物。

| 场景编号 | 标题关键词 | 玩法核心 | 状态 |
|----------|------------|----------|------|
| 0 | 注册仪式 | 纪念日密码 + 线索渐进 | 已实现 ✅ |
| 1 | 高中安抚 | 情绪值 + 组合加成 + 泡泡反馈 | 已实现 ✅ |
| 2 | 高考小游戏 | 顺序四科 + 独立计时 + 宠溺得分 + 三段提示 | 已实现 ✅ |
| 3 | 大学时间线 | 拖拽排序 + 触摸点选交换 | 已实现 ✅ |
| 4 | 表白分支 | 对话逐行 + 选项分支 + 彩蛋 | 基础实现 ✅ |
| 5 | 约会卡牌 | 多关卡卡牌组合 + 协同加成 | 已实现 ✅ |
| 6 | 织围巾 | 点击 / 拖动连续涂抹 + 进度条 | 已实现 ✅ |
| 7 | 未来愿望 | 许愿生成星星 + 终章祝福 | 基础实现 ✅ |

</div>

> 全部纯原生 HTML / CSS / JS，无构建依赖，直接双击 `index.html` 即可体验。

---
## 🔧 快速开始
1. 下载或克隆项目。
2. 用浏览器打开根目录下 `index.html`。
3. 若放到 GitHub Pages / Vercel / Netlify：直接部署静态资源，无需服务器。

可用 URL 参数：
`?forceRegister=1` 强制再次进入注册仪式（或使用快捷键 Ctrl+Alt+R）。

---
## 📁 目录结构
```
assets/
  images/            # 图片（自备真实照片可更有代入感）
  audio/             # 计划中的 BGM / SFX
css/                 # 全局 + 场景样式（集中在 styles.css）
js/
  core/              # BaseScene / SceneManager / EventBus 等基类
  scenes/            # 场景 0~7 源文件
  main.js            # 入口（注册场景 & 全局防抖 & 快捷键）
data/
  questions.json     # 外部题库（存在即覆盖内置）
index.html
README.md
```

---
## 🧭 场景总览（按体验顺序）

### 0. 注册仪式（Scene0Register）
**当前实现**
- 输入任意“用户名” + 纪念日密码（默认 `20241007`）。
- 密码错误计数触发 3 / 5 / 7 次线索（逐条淡入：年 → 月 → 日 + 完整组合）。
- 支持“我忘了”按钮单步解锁下一条线索；终极线索出现后按钮自动禁用。
- 通过写入 `localStorage.hasRegistered=1`，下次自动跳过。
- 支持强制重体验（URL 参数 / 快捷键 / 悬浮按钮）。
- 全局点击防抖：提交、忘记按钮均带 `data-debounce`。 

**未来预期**
- Serious 模式：关闭忘记按钮或延迟可用。
- 成就：不看任何线索一次通过授予徽章。
- 主题可配置：不同纪念日切换背景 / 标题文案。

### 1. 高中安抚（Scene1Intro）
**当前实现**
- 目标情绪值：100。
- 不同类别（comfort / encourage / companion）形成“多样陪伴”组合：2 类+2、3 类+4 加成。
- 情绪泡泡漂浮反馈（正向 / 负向 / 组合 / 救援 / 彩蛋）。
- 连续负向：第 3 次触发救援反弹 +8 正向；负面逐步柔化。
- 标题点击：7 次提示，10 次一次性 +5 加成彩蛋。
- 50% 进度出现“我现在就抱紧你”按钮（快速补满 → 跳转场景2）。
- 冷启动 2 秒禁用所有按钮（视觉提示“缓冲”）。
- 防抖：快速抱紧按钮 `data-debounce` 防止重复触发。
 - 可选 BGM：进入场景自动淡入播放，可用音符按钮静音/恢复。

**未来预期**
- 统计面板：显示最高组合数 / 负向救援触发次数。
- 难度可选：提高目标值或减少加成。
- BGM 节奏联动：情绪越高音乐层次增加。

### 2. 高考小游戏（Scene2Exam）
**当前实现（最新）**
- 科目顺序解锁：语文 → 数学 → 英语 → 理科。
- 每科独立 5 分钟倒计时；完成或超时进入总结并解锁下一科。
- 科目间闲置 30 秒触发“懒散彩蛋”提示，进入下一科后移除。
- 外部题库 JSON 自动覆盖内置（结构见下）。
- 难度权重：easy=1 / medium=2 / hard=3；得分=2*权重（跳过/错误/第三次提示均满分宠溺）。
- 提示三段：前两次文本提示，第 3 次直接给答案并给满分。
- 彩蛋优先级：全跳过 > 全错误宠溺 > 半数跳过（互斥）。
- 结果面板：得分 + 科目统计 + 彩蛋标签。
 - 可选 BGM：用户首次交互点击后淡入播放，可静音切换；离场淡出。

**未来预期**
- Serious 模式：跳过 0 分 / 错误扣分 / 第三次提示不给分。
- 成就：全对 / 无提示 / 仅一次提示 / 全跳过 / 全错被宠。
- 统计可视化：雷达（知识维度）+ 堆叠条形（得分来源）。
- 题型插件：多选 / 匹配拖拽 / 音频题。
- 融合场景1 情绪值：题目表现影响情绪轨迹。

### 3. 大学时间线（Scene3Timeline）
**当前实现（含移动端适配）**
- 桌面：原生 Drag & Drop 拖拽排序。
- 触摸：点选一项高亮，3.5 秒内点第二项 → 交换（未选第二项自动取消）。
- 校验成功可继续下一场景。

**未来预期**
- 局部错位评分：给“几乎完美”文案。
- 事件卡片悬浮图片 / 备注。
- 成功动画：逐条渐入 + 时间轴线动画。
- 终章引用：显示“你记对了 X% 的大学记忆”。

### 4. 表白分支（Scene4Confession）
**当前实现**
- 对话逐行延迟展示；选择互动按钮触发不同回应。
- 暂存选择路径（用于后续彩蛋扩展）。
- 权限内小彩蛋按钮（隐藏按钮或特定点击次数触发）。

**未来预期**
- 多轮记忆：后续场景读入你在此场景的“回答风格”。
- 分支结局徽章：温柔派 / 贫嘴派 / 火花派。
- 打字机动画 & 心跳特效。

### 5. 第一次约会（Scene5Date）
**当前实现（卡牌关卡版）**
- 多关卡（levels）配置：每关卡限制选择数量与目标标签倾向。
- 卡牌属性：基础分数 / 标签集合（类型、氛围、协同） / 特殊协同触发。
- 协同系统：特定组合额外加分并漂浮提示；标签多样性与氛围一致度分别加成。
- 总结面板：显示基础分 / 协同分 / 关卡额外加成拆分，关卡推进按钮。
- 最终关：汇总总分与所有触发的协同提示（为成就埋点）。
 - 可选 BGM：进入场景自动淡入播放，音符按钮可静音/恢复。

**未来预期**
- 数据外部化：cards / levels / synergies JSON 化。
- 动态最优提示：展示“理论最高 vs 你的成绩”。
- 成就：全协同解锁 / 任一关完美 / 低配高分（策略型）。
- 严肃模式：未达目标阈值需重试。
- 视觉：选中连接线 / synergy badge 发光动画。

### 6. 织围巾（Scene6Scarf）
**当前实现（连续涂抹升级）**
- Pointer 统一：点击或按住拖动均可连续点亮格子。
- 进度条实时更新；全部点亮显示继续按钮。
- 拖动绘制中阻止触摸滚动，保证流畅。

**未来预期**
- 像素模板：心形/首字母/纪念日图案判定“花样完成度”。
- 多色或渐变模式：进度越高色温升高。
- 拖动粒子尾迹 / 织线动画。
- 指标：总耗时 / 每秒针数 / 连续涂抹最长路径。

### 7. 未来愿望星空（Scene7Future）
**当前实现**
- 输入愿望生成星点（动画闪烁）。
- 达到指定愿望数量出现终章祝福卡片（现实祝福，不循环重开）。
- 支持自定义愿望数量阈值。

**未来预期**
- 星星分类（旅行 / 成长 / 情感）→ 不同颜色。
- 点击星星回显愿望全文 / 编辑 / 标记完成。
- 读取前面场景统计（题目跳过次数、组合最高值）嵌入终章文案个性化。

---
## 📌 外部题库结构（场景2）
```jsonc
{
  "chinesePoemFill": [
    { "question": "山有木兮木有枝，_____", "answer": "心悦君兮君不知", "encourageCorrect": "诗意满分！", "encourageWrong": "再想想那句古风情话~" }
  ],
  "mathPuzzles": [
    { "question": "(5 + 1) × 2 - 3 = ?", "answer": "9", "encourageCorrect": "脑力很清醒！", "encourageWrong": "括号顺序再过一遍~" }
  ],
  "englishMatch": [
    { "word": "forever", "match": "永远", "encourageCorrect": "Forever = 永远爱你", "encourageWrong": "我们常说的那个‘永**’" }
  ],
  "scienceQuiz": [
    { "question": "彩虹形成主要和什么光学现象有关？", "options": ["折射","衍射","干涉"], "answer": 0, "encourageCorrect": "彩虹为你弯下腰~", "encourageWrong": "想想光进水再出来会怎样~" }
  ]
}
```
字段说明：
- ch\*：不同题型数组；存在即覆盖该类默认题。
- `encourageCorrect` / `encourageWrong`：个性化鼓励。
- 选择题 `answer` 为索引；填空 / 配对类型 `answer` 为字符串。

---
## ❤️ 宠溺/得分与提示规则速览
- 正确 / 跳过 / 错误（被宠）/ 第三次提示 → 统一给满分（2 * 难度权重）。
- 提示机制：前两次展示文本，第 3 次直接送答案 + 满分。
- 彩蛋优先级：全跳过 > 全错误宠溺 > 半数跳过。
- 未来 Serious 模式将收紧：跳过不给分 / 错误减分 / 第三次提示只给 0 分答案提示。

---
## 🛡️ 全局机制
| 机制 | 描述 |
|------|------|
| 场景管理 | `SceneManager` 控制生命周期 enter/exit，防并发切换锁。|
| 转场场景 (NEW) | `TransitionScene` 作为中介：播放 1.4s 情绪动画 + 粒子，期间旧 BGM 淡出，下一场景自行淡入新 BGM。当前仅 demo: intro → exam。|
| 事件总线 | `EventBus`（当前轻量，预留解耦扩展）。|
| 全局防抖 | 任意元素加 `data-debounce` 即可，捕获阶段阻断重复点击。|
| 本地持久 | `localStorage.hasRegistered` 标记注册通过一次即可跳过。|
| 外部题库 | 自动 fetch `data/questions.json` 覆盖内置。|
| 彩蛋系统 | 目前分散（场景1 标题点击 / 场景2 结果统计），后续计划集中注册。|
| 移动端适配 | 时间线触摸点选交换 / 围巾拖动连续涂抹 / 按钮命中区域放大 | ✔ 已完成首轮 |

---
## 📱 移动端适配说明
近期完成：
- 时间线：触摸端自动启用“点选两项交换”模式（无原生拖拽兼容问题）。
- 围巾：指针按下进入绘制模式，滑动连续点亮；指针抬起/取消即结束。
- 样式：触摸环境放大按钮与卡牌内边距；围巾格子尺寸放大；禁用绘制区域滚动。
- 检测：使用 `(pointer:coarse)` 作为触摸环境判定，不影响桌面逻辑。

待改进：
- pointermove 高频：可做节流（每 ~8ms 合并）。
- 触觉反馈：调用 `navigator.vibrate`（需用户手势授权）。
- 橫屏布局微调：围巾栅格自适应换行。

---
## 🧩 自定义常用入口
- 修改安抚按钮：`scene1_intro.js` 里 `<button data-mood ...>` 节点列表。
- 修改题库：放置 / 编辑 `data/questions.json`。
- 增减时间线事件：`scene3_timeline.js` 的 `this.items`。
- 增加表白台词：`scene4_confession.js` 中对话数组。
- 修改菜单：`scene5_date.js` 的 `this.menu`。
- 围巾尺寸：`scene6_scarf.js` 中网格行列参数。
- 愿望阈值：`scene7_future.js` 中 `this.required`。
- 转场动画：`scene_transition.js` 可扩展 `style` 分支（目前仅 `heart`）。

TODO（后续将逐步用转场包装的跳转示例）：
```
intro -> exam        ✅ 已接入
exam -> timeline     ⏳ 待接入
timeline -> confession ⏳ 待接入
confession -> date   ⏳ 待接入
date -> scarf        ⏳ 待接入
scarf -> future      ⏳ 待接入
```

---
## 🪄 未来路线（Roadmap）
| 类别 | 计划 | 状态 |
|------|------|------|
| 模式 | Serious 模式（收紧容错） | 待设计 |
| 成就 | 全对 / 无提示 / 零跳过 / 彩蛋收集 | 待实现 |
| 统计 | 组合最高值 / 错误来源分析 | 待实现 |
| 音频 | BGM + 微动效音效 | 待添加 |
| 转场 | 多款主题：heart / petal / memory fade / star tunnel | 进行中 (已上线 heart demo) |
| 彩蛋 | 统一 registry + 条件 DSL | 规划中 |
| 个性化 | 终章引用前面统计（例如你“××题都跳过”） | 规划中 |
| UI | 主题切换（粉 / 暖白 / 星空） | 规划中 |
| 国际化 | 全文案 JSON 化 + 多语言 | 规划中 |
| 移动端 | 时间线触摸交换 + 围巾拖涂 + 基础尺寸优化 | 已完成 ✅ |

---
## 📝 素材准备清单
- 高中安抚真实语气 5~8 句
- 高考题库（可按你们的梗定制）
- 大学事件 4~6 条（带年份 / 月份）
- 表白真情台词分支（甜 / 搞怪 / 深情）
- 约会菜单（菜品 + 共同回忆标签）
- 围巾是否要心形、首字母或日期彩蛋
- 未来愿望 6~10 条（旅行 / 成长 / 生活 / 仪式）
- 私人彩蛋关键词（昵称 / 暗号）

---
## 🚀 部署
- GitHub Pages：Settings → Pages → 选 main 分支 root。
- Vercel / Netlify：直接导入仓库 → 部署。
- 本地打包：压缩整个目录发送即可离线打开。

---
## 🔐 隐私 & 安全
若包含真实照片 / 聊天记录，避免公开仓库；或改用临时受限分享链接。

---
## License
私人情感礼物项目（非商业）。如需二次传播请先移除私人素材。

> 祝：故事继续被认真书写，愿望都按计划一个个兑现。❤️
